<div class="d-flex justify-content-center mt-5">
  <div *ngIf="carregando" class="d-flex justify-content-center align-items-center flex-column"
    style="position: fixed; inset: 0; width: 100vw; height: 100vh; background-color: rgba(255, 255, 255, 0.8); z-index: 1050;">
    <div class="spinner-grow text-dark" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-3 fs-5 fw-medium">
      <span style="font-family: 'Montserrat', sans-serif; color: #38928a;">Por favor, aguarde...</span>
    </p>
  </div>

  <div class="card w-65 shadow">
    <table style="margin-left: 15px; margin-top: 20px; margin-bottom: 20px;">
      <tr>
        <td class="alinhado-centro">
          <span class="cor-quadrado bg-atencao-soft"></span>
          <span class="text-dark-custom">&nbsp;&nbsp;Até o segundo dia em atraso&nbsp;&nbsp;</span>
        </td>
        <td class="alinhado-centro">
          <span class="cor-quadrado bg-atrasado-soft"></span>
          <span class="text-dark-custom">
            &nbsp;&nbsp;Atrasos acima do terceiro dia estão sujeitos à cobrança de tarifa adicional&nbsp;&nbsp;
          </span>
        </td>
      </tr>
    </table>
    <div class="card-body p-0">
      <div class="scroll-box" style="max-height: 70vh; overflow-y: auto;">
        <div class="table table-responsive">
          <table class="table table-bordered small-font table-striped">
            <thead class="thead align-middle">
              <tr>
                <th> </th>
                <th>
                  Status atual
                  <input type="text" class="form-control form-control-sm mt-1" [(ngModel)]="filtroStatus"
                    placeholder="Filtrar status">
                </th>
                <th>
                  Fila criada e em uso
                  <input type="text" class="form-control form-control-sm mt-1" [(ngModel)]="filtroFila"
                    placeholder="Filtrar fila">
                </th>
                <th>
                  Data da publicação
                  <input type="text" class="form-control form-control-sm mt-1" [(ngModel)]="filtroData"
                    placeholder="Filtrar data">
                </th>
                <th>
                  Definição da fila
                  <input type="text" class="form-control form-control-sm mt-1" [(ngModel)]="filtroDescricao"
                    placeholder="Filtrar uso">
                </th>
                <th>
                  Tipo de arquivo
                  <input type="text" class="form-control form-control-sm mt-1" [(ngModel)]="filtroTipo"
                    placeholder="Filtrar tipo">
                </th>
                <th>
                  Total de registros
                  <input type="number" class="form-control form-control-sm mt-1" [(ngModel)]="filtroRegistros"
                    placeholder="Filtrar">
                </th>
                <th class="text-center align-middle">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                    class="bi bi-calculator-fill" viewBox="0 0 16 16">
                    <path
                      d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm2 .5v2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5m0 4v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5M4.5 9a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM4 12.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5M7.5 6a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM7 9.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5m.5 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM10 6.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5m.5 2.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5z" />
                  </svg>
                </th>

                <th class="text-center align-middle">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                    class="bi bi-file-arrow-down" viewBox="0 0 16 16">
                    <path
                      d="M8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5" />
                    <path
                      d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" />
                  </svg>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of getDocumentacaoFiltrada(); let i = index" class="tr">
                <td>{{ i + 1 }}</td>
                <td [ngClass]="[getCorLinha(item.dataEnvio, item.status)]">{{ item.status }}</td>
                <td class="text-start" style="max-width: 400px; word-break: break-word; white-space: normal;">{{
                  item.queueName }}</td>
                <td>{{ item.dataEnvio }}</td>
                <td class="text-start" style="max-width: 400px; word-break: break-word; white-space: normal;">
                  {{ item.descricao }}
                </td>
                <td class="text-left">{{ item.tipoArquivo }}</td>
                <td class="text-center">{{ item.registros }}</td>
                <td class="text-center align-middle">
                  <button type="button" class="btn btn-light" (click)="abrirCalculadora(item.guid)"
                    data-bs-toggle="modal" data-bs-target="#calculadoraModal">
                    <i class="bi bi-calculator" style="cursor:pointer"></i>
                  </button>
                </td>
                <td class="text-center align-middle">
                  <button type="button" class="btn btn-light"
                    (click)="downloadFilaMsg(item.nomeFila)">
                    <i class="bi bi-filetype-json" width="30" height="30"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="calculadoraModal" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ModalLabel"><strong>Cálculo da tarifa com base na data atual, aplicável apenas em
            caso de cobrança.</strong></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <table class="table table-borderless">
          <tr>
            <td>
              Situação:<strong>{{status}}</strong>
              <small class="text-muted fst-italic">Visualizado em:{{hoje | date:'dd/MM/yyyy HH:mm'}}</small>
            </td>
          </tr>

          <tr>
            <td>Data do envio:{{ dataEnvio }}</td>
          </tr>

          <tr>
            <td class="justify-text">
              A cobrança proporcional pelos dias de Retenção terá início após <b>3</b> dias corridos do
              vencimento.
            </td>
          </tr>

          <tr>
            <td>
              <hr class="my-1">
            </td>
          </tr>

          <tr>
            <td>Registros publicados:<strong>{{ registros }}</strong></td>
          </tr>

          <tr>
            <td>Dias em atraso:<strong>{{ diasAtraso(dataEnvio, ativo) }}</strong></td>
          </tr>

          <tr>
            <td>Tamanho em KB:<strong>{{ quantidadeBytes }}</strong></td>
          </tr>

          <tr>
            <td>Valor por dia em atrado: R$<strong>{{ valorRetencaoExtraPorDia }}</strong></td>
          </tr>

          <tr>
            <table>
              <tr>
                <td class="justify-text">
                  Tarifa cobrada ( Dias em atraso * Valor por dia em atrado ):<br>
                  <strong style="color: red;">R$ {{ tarifa | number:'1.2-2' }}</strong>
                </td>
              </tr>
            </table>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>